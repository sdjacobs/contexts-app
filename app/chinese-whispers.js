var makeWhispers=function(){function s(e){var t=Math.floor(Math.random()*e.length),n=e[t];return e.splice(t,1),n}function o(n,r){function o(){!n()&&!s?setTimeout(o,r):(i.end({type:"end",nodes:t}),i.on("start.code",e.run))}var s=!1;i.on("end.code",function(){s=!0}),i.on("start.code",function(){s=!1,o()}),o()}function u(e){var t={};e.inEdges.forEach(function(e){t[e.source.group]=e.value});var n=0,r=e.group;for(var i in t)t[i]>=n&&(r=i,n=t[i]);return r}var e={},t,n,r,i=d3.dispatch("start","tick","step","end");return e.run=function(){function l(){var n=s(f);if(!n){f=t.slice(0);var r=a==f.length;return a=0,i.step({type:"step",groups:e}),r&&i.end({type:"end",nodes:t}),r==1?!0:undefined}var o=u(n);return o==n.group&&(a+=1),e[n.group]-=1,e[o]=(e[o]||0)+1,n.group=o,i.tick({type:"tick",groups:e}),!1}function c(){var n=0;while(f.length!=0){var r=s(f),o=u(r);o==r.group&&(n+=1),e[r.group]-=1,e[o]=(e[o]||0)+1,r.group=o}return i.step({type:"step",groups:e}),f=t.slice(0),n==f.length}var e=[];t.forEach(function(t,n){t.group=n,t.inEdges=[],e[n]=1}),n.forEach(function(e){e.target.inEdges.push(e)});var a=0,f=[],h=r?l:c;o(h,0)},e.nodes=function(n){return arguments.length?(t=n,e):t},e.edges=function(t){return arguments.length?(n=t,e):n},e.animateTicks=function(t){return arguments.length?(r=t,e):r},i.on("start.code",e.run),d3.rebind(e,i,"on","end","start")};define(["d3"],function(e){return makeWhispers});