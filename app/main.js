define(["require","d3","interact"],function(e){function o(e,t){e.attr("class","draggable");var r=n(".draggable");e.selectAll("select, input, button, .container").each(function(){this.onmouseover=function(){r.draggable(!1)},this.onmouseout=function(){r.draggable(!0)}}),e.style("background-color",t),e.append("button").attr("style","position: absolute; top:0; right:0;").text("x").on("click",function(){e.remove()}),e.on("mousedown",u)}function u(){t.selectAll(".draggable").style("z-index",0),t.select(this).style("z-index",1)}function a(e){var t=e.getBoundingClientRect();return[t.left,t.bottom]}function f(e,t,n,r){var i=a(e);t=typeof t=="object"?t:document.getElementById(t);var s=a(t);t.style.left=s[0]+"px",t.style.top=i[1]+(n?n:0)+"px",t.style.position!="absolute"&&(t.style.position="absolute")}var t=e("d3"),n=e("interact"),r=t.scale.category10(),i=function(){return r(r.domain().length)},s=n(".draggable").draggable({onmove:function(e){var t=e.target,n=(parseFloat(t.getAttribute("data-x"))||0)+e.dx,r=(parseFloat(t.getAttribute("data-y"))||0)+e.dy;t.style.webkitTransform=t.style.transform="translate("+n+"px, "+r+"px)",t.setAttribute("data-x",n),t.setAttribute("data-y",r)}}).resizable(!0).on("resizemove",function(e){var t=e.target,n=parseFloat(t.style.width)+e.dx,r=parseFloat(t.style.height)+e.dy;t.style.width=n+"px",t.style.height=r+"px"});t.select(".draggable").style("background-color",i()).on("mousedown",u),t.json("modules.json",function(n){function a(n){t.xhr(n.page,"text/html",function(r){var u=i(),a=l(t.select("#menu")),c=l(t.select("#content")),h=t.select("#menu").append("div").html(r.response).attr("style","width: 300px; height: 200px;").attr("name",n.name).call(o,u);f(a,h.node(),-20);var p=t.select("#content").append("div").attr("style","width:500px;height:500px").attr("name",n.name+" viz");c&&f(c,p.node(),0,-10);var d=p.append("div").attr("class","container").attr("style","width:100%; height:95%;").style("background-color","white").style("color","black");p.call(o,u),e(n.deps,function(e){e(d.node(),s)})})}function l(e){var t=e.selectAll("div"),n=0,r=undefined;return t.each(function(){var e=this.getBoundingClientRect().y;e>n&&(n=e,r=this)}),r}t.select("#menu").select("div").selectAll("li").data(n).enter().append("li").append("a").attr("href","#").text(function(e){return e.name}).on("click",a).append("br");var r=t.set();n.forEach(function(e){e.exports.forEach(function(e){r.add(e)}),e.imports.forEach(function(e){r.add(e)})});var s=t.dispatch.apply(this,r.values()),u={};r.values().forEach(function(e){s.on(e+".main",function(t){u[e]=t})}),s.on_init=function(e,t){s.on(e,t);var n=e.split(".")[0];u[n]&&t(u[n])}})});