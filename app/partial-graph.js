function partialGraph(){function s(e){var t=Math.pow(40*e.size,1/3);return t}function u(e,t){return f(e,t)||a(e,t)||e.index==t.index}function a(e,t){return linkedByIndex[e.index+","+t.index]}function f(e,t){return linkedByIndex[t.index+","+e.index]}function l(e,t){return e.index==t.index}function c(){link.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}).attr("d",function(e){var t=e.target.x-e.source.x,n=e.target.y-e.source.y,r=75/e.linknum;return"M"+e.source.x+","+e.source.y+"A"+r+","+r+" 0 0,1 "+e.target.x+","+e.target.y}),node.attr("transform",function(e){return"translate("+e.x+","+e.y+")"})}var e,t,n,r,i,o=function(e){i=e};return o.draw=function(){function o(){svg.attr("transform","translate("+d3.event.translate+")"+" scale("+d3.event.scale+")")}function u(e){d3.select(this).classed("fixed",e.fixed=!1)}i.selectAll("*").remove();var n=parseInt(i.style("width")),r=parseInt(i.style("height"));force=d3.layout.force().nodes(e).links(t).charge(-3e3).friction(.6).gravity(.6).size([n,r]).start(),linkedByIndex={},t.forEach(function(e,t){e.linknum=t+1,linkedByIndex[e.source.index+","+e.target.index]=!0}),svg=i.append("svg").attr("width",n).attr("height",r).call(d3.behavior.zoom().on("zoom",o)).on("dblclick.zoom",null).append("g"),link=svg.selectAll("path").data(t).enter().append("path").attr("class","p_path"),node=svg.selectAll(".node").data(e).enter().append("g").attr("class","p_node").call(force.drag),node.append("circle").attr("r",s).on("mouseover",mouseOverFunction).on("mouseout",mouseOutFunction),node.append("text").attr("x",12).attr("dy",".35em").classed({partial:!0,shadow:!0}).text(function(e){return e.label}),node.append("text").classed("partial",!0).attr("x",12).attr("dy",".35em").text(function(e){return e.label}),node.on("dblclick",u),force.on("tick",c),drag=force.drag().on("dragstart",function(e){d3.event.sourceEvent.stopPropagation(),fixedMode&&d3.select(this).classed("fixed",e.fixed=!0)}),fixedMode=!1},o.nodes=function(e){return arguments.length?(n=e,o):n},o.links=function(e){return arguments.length?(r=e,o):r},o.makePartialGraph=function(i,s,o){var u=n.find(function(e){return e.label==i});if(!u){alert("selected node not found");return}var a=[{node:u,ngens:o,id:0}];e=[],t=[];var f=0;while(a.length>0){var l=a.pop();e.push({label:l.node.label,id:l.id,size:(l.ngens+1)*10});if(l.ngens==0)continue;var c=findNeighbors(n,r,l.node);c=c.slice(0,s),c.forEach(function(n){var r=e.findIndex(function(e){return e.label==n.label});r==-1&&(f++,a.push({node:n,ngens:l.ngens-1,id:f}),r=f),t.push({source:l.id,target:r})})}},mouseOverFunction=function(e){var t=d3.select(this);node.transition(500).style("opacity",function(t){return u(t,e)?1:.2}).style("fill",function(t){return f(t,e)&&a(t,e)?fillcolor="green":a(t,e)?fillcolor="green":f(t,e)?fillcolor="green":l(t,e)?fillcolor="hotpink":fillcolor="#000",fillcolor}),link.transition(500).style("stroke-opacity",function(t){return t.source===e||t.target===e?1:.2}),t.transition(500).attr("r",function(){return 1.4*s(e)})},mouseOutFunction=function(){var e=d3.select(this);node.transition(500).style("fill","black").style("opacity",1),link.transition(500).style("stroke-opacity",1),e.transition(500).attr("r",s)},o}define(["d3"],function(e){return partialGraph});