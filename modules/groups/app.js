define(["d3","app/filepicker","app/chinese-whispers"],function(e,t,n){function i(t){var n=e.csv.parse(t);r.groupsByWord={},n.forEach(function(e){r.groupsByWord[e.word]=e.group}),r.color&&o()}function s(t){r.graph=t.graph,r.nodes=t.graph.nodes(),r.edges=t.graph.edges(),r.container=t.container,r.type=t.type;var n=e.select(r.container).selectAll(".node"),i=e.scale.category20();t.type=="svg"?r.color=function(){n.style("fill",function(e){return i(e.group)})}:r.color=function(){r.nodes.forEach(function(e){e.color=i(e.group)}),r.graph.redraw()},r.groupsByWord&&o(),a()}function o(){r.nodes.forEach(function(e){e.group=r.groupsByWord[e.label]||"other"}),u()}function u(){var t={},n=r.nodes,i=e.select(r.viz);n.forEach(function(e){g=e.group.toString(),t[g]==undefined&&(t[g]=[]),t[g].push(e.label)}),i.selectAll("*").remove(),i.append("ul").selectAll("li").data(e.entries(t)).enter().append("li").text(function(e){return e.key+": "+e.value.join(", ")})}function a(){var t=0;r.whispers.nodes(r.nodes).edges(r.edges).on("tick",r.color).on("step",function(n){e.select("#nIterations").text(String(t)),e.select("#nGroups").text(String(f(n.groups))),r.color(),t++}).on("end.g",function(e){t=0,u(r.nodes)})}function f(e){return e.filter(function(e){return e!=0}).length}var r={};return r.whispers=n(),e.select("#addColor").on("click",function(){r.groupsByWord?r.color?r.color():alert("Load a graph."):alert("Load data or run an algorithm to generate groups.")}),e.select("#inputAlgo").on("click",function(){e.select("#algorithm-controls").style("visibility","visible"),e.select("#groupsFile").attr("disabled",!0),e.select("#addColor").attr("disabled",!0)}),e.select("#inputFile").on("click",function(){e.select("#algorithm-controls").style("visibility","hidden"),e.select("#groupsFile").attr("disabled",null),e.select("#addColor").attr("disabled",null)}),e.select("#groupsFile").call(t(),["12dicts-categories.csv"],i),e.select("#runWhispers").on("click",function(){r.graph.stop(),r.whispers.start()}),e.select("#animateTicks").on("change",function(){whispers.animateTicks(e.event.target.checked)}),e.select("#stopWhispers").on("click",r.whispers.end),function(e,t){r.viz=e,t.on_init("graph",s)}});